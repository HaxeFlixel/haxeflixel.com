<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8"/>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

	<title>Part IX: UI and Combat | HaxeFlixel 2D Game Framework</title>

	<meta name="description" content="HaxeFlixel is a 2D Game framework that lets you create cross-platform games easier with free, open source technology!"/>
	<meta name="keywords" content="gamedev, game development, cross-platform, haxe, flixel"/>
	<meta name="author" content=""/>
	<meta name="viewport" content="width=device-width"/>

	<link rel="shortcut icon" href="/images/favicon.ico">

	<!--[if lt IE 9]>
	<script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<link  rel="stylesheet" href="/styles/style.css" />

</head>


<body>

<header>
	<nav>

		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">

				<div class="navbar-header">
					<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="/" class="navbar-brand"><img src="/images/haxeflixel-header.png" alt="HaxeFlixel"></a>
				</div>

				<div class="navbar-collapse collapse">

					<ul class="nav navbar-nav">

						<li >
							<a href="/demos">Demos</a>
						</li>

                        <li class="dropdown" >

                            <a href="/showcase" class="dropdown-toggle" data-toggle="dropdown">Showcase <span class="caret"></span></a>

                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <a href="/showcase/games">Games</a>
                                </li>
                                <li>
                                    <a href="/showcase/jams">Jams</a>
                                </li>
                            </ul>

                        </li>

						<li >
							<a href="/blog">Blog</a>
						</li>

						<li class='active'>
							<a href="/documentation">Docs</a>
						</li>

						<li>
							<a href="http://api.haxeflixel.com" target="_blank">API</a>
						</li>

						<li >
							<a href="/forum">Forum</a>
						</li>

					</ul>
		
					<form class="navbar-form search-form" role="search" action="http://google.com/search" method="get">
    <div class="form-group">
        <input type="search" name="q" class="form-control" placeholder="Search">
        <input type="hidden" name="q" value="site:http://haxeflixel.com">
    </div>
</form>

				</div>

			</div>

		</div>

	</nav>
</header>

<div class="container container-main">
	<div class="row">

		<div class="col-md-3">
			<div class="doc-nav affix">
				<ul class="nav">



	<li>
		<h4><a href="/documentation/getting-started">Getting Started</a><h4>
	</li>

	



	<li>
		<h4><a href="/documentation/community">Community</a><h4>
	</li>

	



	<li>
		<h4><a href="/documentation/haxeflixel-handbook">HaxeFlixel Handbook</a><h4>
	</li>

	



	<li>
		<h4><a href="/documentation/resources">Resources</a><h4>
	</li>

	



	<li>
		<h4><a href="/documentation/tutorials">Tutorials</a><h4>
	</li>

	
		
			<li class= about="/documentation/tutorials">
				<a href="/documentation/tutorials"> Tutorials </a>
			</li>
		
			<li class= about="/documentation/the-power-of-haxeflixel">
				<a href="/documentation/the-power-of-haxeflixel"> The Power of HaxeFlixel </a>
			</li>
		
			<li class= about="/documentation/part-i-setup">
				<a href="/documentation/part-i-setup"> Part I: Setup </a>
			</li>
		
			<li class= about="/documentation/part-ii-testing">
				<a href="/documentation/part-ii-testing"> Part II: Testing wit ... </a>
			</li>
		
			<li class= about="/documentation/part-iii-groundwork">
				<a href="/documentation/part-iii-groundwork"> Part III: Groundwork </a>
			</li>
		
			<li class= about="/documentation/part-iv-sprites-and-animation">
				<a href="/documentation/part-iv-sprites-and-animation"> Part IV: Sprites and ... </a>
			</li>
		
			<li class= about="/documentation/part-v-tiles-maps-and-collisions">
				<a href="/documentation/part-v-tiles-maps-and-collisions"> Part V: Tiles, Maps, ... </a>
			</li>
		
			<li class= about="/documentation/part-vi-zoom-and-cameras">
				<a href="/documentation/part-vi-zoom-and-cameras"> Part VI: Zoom and Cameras </a>
			</li>
		
			<li class= about="/documentation/part-vii-pickups">
				<a href="/documentation/part-vii-pickups"> Part VII: Pickups </a>
			</li>
		
			<li class= about="/documentation/part-viii-enemies-and-basic-ai">
				<a href="/documentation/part-viii-enemies-and-basic-ai"> Part VIII: Enemies a ... </a>
			</li>
		
			<li class=active about="/documentation/part-ix-ui-and-combat">
				<a href="/documentation/part-ix-ui-and-combat"> Part IX: UI and Combat </a>
			</li>
		
			<li class= about="/documentation/part-x-winning-and-losing-and-menus">
				<a href="/documentation/part-x-winning-and-losing-and-menus"> Part X:  Winning and ... </a>
			</li>
		
			<li class= about="/documentation/part-xi-sound-and-music">
				<a href="/documentation/part-xi-sound-and-music"> Part XI: Sound and Music </a>
			</li>
		
			<li class= about="/documentation/part-xii-multiple-platforms">
				<a href="/documentation/part-xii-multiple-platforms"> Part XII: Multiple Platforms </a>
			</li>
		
			<li class= about="/documentation/part-xiii-polish-finishing-up-and-juice">
				<a href="/documentation/part-xiii-polish-finishing-up-and-juice"> Part XIII: Polish, f ... </a>
			</li>
		
			<li class= about="/documentation/conclusion">
				<a href="/documentation/conclusion"> Conclusion </a>
			</li>
		
	



</ul>
			</div>
		</div>

		<div class="col-md-9 doc-content" role="main">
			<h1 class="title">Part IX: UI and Combat</h1>

			
			<a href="https://github.com/HaxeFlixel/flixel-docs/blob/master/documentation/04_tutorials/10-part-ix-ui-and-combat.html.md" class="btn btn-sm btn-edit" target="_blank"><span class="glyphicon glyphicon-pencil"></span> Edit </a>

			<p>Now we want to show the player what&#39;s going on. So we need to have some kind of HUD on the screen to tell them what their current/max health is, and how many coins they have.</p>

<ol>
    <li>
        <p>We&#39;ll start by making a new HUD class which will hold all our HUD elements:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="package"><span class="keyword">package</span> ;

<span class="title">import</span> <span class="title">flixel</span>.<span class="title">FlxBasic</span>;
<span class="title">import</span> <span class="title">flixel</span>.<span class="title">FlxG</span>;
<span class="title">import</span> <span class="title">flixel</span>.<span class="title">FlxSprite</span>;
<span class="title">import</span> <span class="title">flixel</span>.<span class="title">group</span>.<span class="title">FlxGroup</span>;
<span class="title">import</span> <span class="title">flixel</span>.<span class="title">text</span>.<span class="title">FlxText</span>;
<span class="title">import</span> <span class="title">flixel</span>.<span class="title">util</span>.<span class="title">FlxColor</span>;
<span class="title">using</span> <span class="title">flixel</span>.<span class="title">util</span>.<span class="title">FlxSpriteUtil</span>;

<span class="title">class</span> <span class="title">HUD</span> <span class="title">extends</span> <span class="title">FlxTypedGroup</span>&lt;<span class="title">FlxSprite</span>&gt;
{</span>

    <span class="keyword">private</span> <span class="keyword">var</span> _sprBack:FlxSprite;
    <span class="keyword">private</span> <span class="keyword">var</span> _txtHealth:FlxText;
    <span class="keyword">private</span> <span class="keyword">var</span> _txtMoney:FlxText;
    <span class="keyword">private</span> <span class="keyword">var</span> _sprHealth:FlxSprite;
    <span class="keyword">private</span> <span class="keyword">var</span> _sprMoney:FlxSprite;

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">new</span><span class="params">()</span> 
    {</span>
        <span class="keyword">super</span>();
        _sprBack = <span class="keyword">new</span> FlxSprite().makeGraphic(FlxG.width, <span class="number">20</span>, FlxColor.BLACK);
        _sprBack.drawRect(<span class="number">0</span>, <span class="number">19</span>, FlxG.width, <span class="number">1</span>, FlxColor.WHITE);
        _txtHealth = <span class="keyword">new</span> FlxText(<span class="number">16</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="string">"3 / 3"</span>, <span class="number">8</span>);
        _txtHealth.setBorderStyle(FlxText.BORDER_SHADOW, FlxColor.GRAY, <span class="number">1</span>, <span class="number">1</span>);
        _txtMoney = <span class="keyword">new</span> FlxText(<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="string">"0"</span>, <span class="number">8</span>);
        _txtMoney.setBorderStyle(FlxText.BORDER_SHADOW, FlxColor.GRAY, <span class="number">1</span>, <span class="number">1</span>);
        _sprHealth = <span class="keyword">new</span> FlxSprite(<span class="number">4</span>, _txtHealth.y + (_txtHealth.height/<span class="number">2</span>)  - <span class="number">4</span>, AssetPaths.health&lt;strong&gt;png);
        _sprMoney = <span class="keyword">new</span> FlxSprite(FlxG.width - <span class="number">12</span>, _txtMoney.y + (_txtMoney.height/<span class="number">2</span>)  - <span class="number">4</span>, AssetPaths.coin&lt;/strong&gt;png);
        _txtMoney.alignment = <span class="string">"right"</span>;
        _txtMoney.x = _sprMoney.x - _txtMoney.width - <span class="number">4</span>;
        add(_sprBack);
        add(_sprHealth);
        add(_sprMoney);
        add(_txtHealth);
        add(_txtMoney);
        forEach(<span class="function"><span class="keyword">function</span><span class="params">(spr:FlxSprite)</span> {</span>
            spr.scrollFactor.<span class="keyword">set</span>();
        });
    }

    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updateHUD</span><span class="params">(Health:Int = 0, Money:Int = 0)</span><span class="type">:Void</span>
    {</span>
        _txtHealth.text = Std.string(Health) + <span class="string">" / 3"</span>;
        _txtMoney.text = Std.string(Money);
        _txtMoney.x = _sprMoney.x - _txtMoney.width - <span class="number">4</span>;
    }
}</code></pre></p>
        <p>This class extends FlxTypedGroup&lt;FlxSprite&gt; so that it can hold all of our FlxSprite objects. It is composed of 5 different items: a background (black, with a 1-pixel thick white line along the bottom), 2 FlxText objects: 1 for Health, and 1 for Money, and 2 FlxSprites, for the icons to go next to the FlxTexts. At the end of our constructor, we have a forEach call - we use this to iterate through each of the items in this group, and it just sets their scrollFactor.x and scrollFactor.y to 0, meaning, even if the camera scrolls, all of these items will stay at the same position relative to the screen.</p>
        <p>Finally, we have a function that we can call from anywhere to tell the HUD what it should display.</p>
    </li>
    <li>
        <p>Now let&#39;s get it to work and have it update whenever we pick up a coin.</p>
        <p>In your PlayState, add to the top of the class:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">private</span> <span class="keyword">var</span> _hud:HUD;
<span class="keyword">private</span> <span class="keyword">var</span> _money:Int = <span class="number">0</span>;
<span class="keyword">private</span> <span class="keyword">var</span> _health:Int = <span class="number">3</span>;</code></pre></p>
    </li>
    <li>
        <p>In the create function, before super.create(), add:</p>
        <p><pre class="highlight"><code class="actionscript">_hud = <span class="keyword">new</span> HUD();
add(_hud);</code></pre></p>
    </li>
    <li>
        <p>Finally, in the playerTouchCoin function we added earlier, somewhere inside the if statement, add:</p>
        <p><pre class="highlight"><code class="actionscript">_money++;
_hud.updateHUD(_health, _money);</code></pre></p>
    </li>
</ol>

<p>Go ahead and test out your game, and the HUD should update each time you pick up a coin!</p>
<p><img src="/images/tutorial/0019.png" /></p>
<p>If we had a way to &#39;hurt&#39; the player, we could also update the health on the HUD… but in order to do that, we need to figure out how we&#39;re going to do combat!</p>

<p>Let&#39;s begin by establishing what we want our combat system to achieve. First, we&#39;re not going to be making the next Final Fantasy game here, this is just a basic demonstration to show how a few different elements can work. So, I think all we want to do is have a simple interface that appears when the player touches an enemy that shows the Player&#39;s health, and the Enemy&#39;s health (in a health bar, for obfuscation), and gives the player 2 options: FIGHT or FLEE.</p>

<p>If they choose to fight, we&#39;ll roll some random chance checks to see if the player hits the enemy, and if the enemy hits the player - a hit will do 1 damage. Once the enemy dies, we&#39;ll continue on. If they choose to flee, we&#39;ll do a check to see if they do flee or not - if they do, the interface closes and the enemy will be stunned for a few seconds so the player can move away. If they fail to flee, the enemy will get a free hit against the player. We&#39;ll also show the damage and Misses on the interface.</p>

<p>This all seems simple enough, but it&#39;s actually going to require several components working together to make it work. It&#39;s the most complicated piece of our game so far.</p>

<ol>
    <li>
        <p>The first component will be our CombatHUD class. This is a pretty big class - it&#39;s going to do most of the heavy lifting with our combat logic. You can see the complete class here:</p>
        <p><a href="https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-IX/source/CombatHUD.hx"><a href="https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-IX/source/CombatHUD.hx">https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-IX/source/CombatHUD.hx</a></a></p>
        <p>Take some time to read through it to see how it works, then add it to your project.</p>
    </li>
    <li>
        <p>Next, we need to get our CombatHUD into our PlayState. Add this to the top of the PlayState Class:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">private</span> <span class="keyword">var</span> _inCombat:Bool = <span class="literal">false</span>;
<span class="keyword">private</span> <span class="keyword">var</span> _combatHud:CombatHUD;</code></pre></p>
    </li>
    <li>
        <p>Move down to the create function, and, after we add the HUD, and before we call super.create, add:</p>
        <p><pre class="highlight"><code class="actionscript">_combatHud = <span class="keyword">new</span> CombatHUD();
add(_combatHud);</code></pre></p>
    </li>
    <li>
        <p>Go down to our update function, and change it so that we&#39;re ONLY checking for collision and overlaps and things when we&#39;re not in combat. Everything after the super.update should look like this:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">if</span> (!_inCombat)
{
    FlxG.collide(_player, _mWalls);
    FlxG.overlap(_player, _grpCoins, playerTouchCoin);
    FlxG.collide(_grpEnemies, _mWalls);
    checkEnemyVision();
    FlxG.overlap(_player, _grpEnemies, playerTouchEnemy);
}
<span class="keyword">else</span>
{
    <span class="keyword">if</span> (!_combatHud.visible)
    {
        _health = _combatHud.playerHealth;
        _hud.updateHUD(_health, _money);
        <span class="keyword">if</span> (_combatHud.outcome == VICTORY)
        {
            _combatHud.e.kill();
        }
        <span class="keyword">else</span>
        {
            _combatHud.e.flicker();
        }
        _inCombat = <span class="literal">false</span>;
        _player.active = <span class="literal">true</span>;
        _grpEnemies.active = <span class="literal">true</span>;&lt;br&gt;    }
}</code></pre></p>
        <p>So, we&#39;re adding a check to see if the player touches an enemy. If they do, we&#39;ll call a callback to see if we should start combat or not.</p>
        <p>If we&#39;re in combat, we&#39;re simply going to keep checking to see if the combatHUD is still visible - once it becomes invisible, we know that combat has finished, and we can determine the outcome. If the outcome is VICTORY (one of our 4 enum values), we will kill the enemy, but if the player Fled the battle, we will make the enemy flicker, to show that the player is safe from fighting it again for a short amount of time.</p>
    </li>
    <li>
        <p>Next, lets add the functions to handle the player touching an enemy:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">playerTouchEnemy</span><span class="params">(P:Player, E:Enemy)</span><span class="type">:Void</span>
{</span>
    <span class="keyword">if</span> (P.alive &amp;&amp; P.exists &amp;&amp; E.alive &amp;&amp; E.exists &amp;&amp; !E.isFlickering())
    {
        startCombat(E);
    }
}

<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">startCombat</span><span class="params">(E:Enemy)</span><span class="type">:Void</span>
{</span>
    _inCombat = <span class="literal">true</span>;
    _player.active = <span class="literal">false</span>;
    _grpEnemies.active = <span class="literal">false</span>;
    _combatHud.initCombat(_health, E);
}</code></pre></p>
        <p>All we&#39;re doing here is checking to see if the player is alive and exists and the enemy is alive and exists and not flickering (flickering enemies are those we&#39;ve just fled from), and if so, we start combat.</p>
        <p>The startCombat function simply sets our inCombat flag (so we know not to do collisions), and sets the player and all the enemies to inactive, so they no longer update.</p>
        <p>Finally, we call the initCombat function in our CombatHUD, which initializes it and makes it start working.</p>
    </li>
    <li>
        <p>Finally, we want enemies that are flickering to not move - they should act kind of stunned for a second after the enemy flees.</p>
        <p>In the Enemy class, under update, add: </p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">if</span> (isFlickering())
    <span class="keyword">return</span>;</code></pre></p>
        <p>At the very top, before doing anything else in that function.</p>
    </li>
</ol>

<p>And that should do it! Test out your game and make sure that it works!</p>
<p><img src="/images/tutorial/0020.png" /></p>
<p>You can see the <a href="https://github.com/SeiferTim/HaxeFlixel-Tutorial/tree/Part-IX">source here</a> to make sure you&#39;re on the same page. Next, we&#39;ll cover winning and losing and setting up all our different FlxStates.</p>

			<br>
			<hr>

			<ul class="pager">
				

				<li class="previous">
					<a href="/documentation/part-viii-enemies-and-basic-ai">< Part VIII: Enemies and Basic AI</a>
				</li>
				


				
				<li class="next">
					<a href="/documentation/part-x-winning-and-losing-and-menus">Part X:  Winning and Losing and Menus ></a>
				</li>
				
			</ul>


		</div>
	</div>
</div>

<footer>
	<div class="footer-main">
		<div class=" container">

			<div class="footer-social">

				<iframe width="120px" scrolling="0" height="20px" frameborder="0"
						allowtransparency="true"
						src="http://ghbtns.com/github-btn.html?user=HaxeFlixel&amp;repo=flixel&amp;type=watch&amp;count=true&amp;size=small"></iframe>

				<a href="https://twitter.com/haxeflixel" class="twitter-follow-button" data-show-count="true"
				   data-lang="en" data-size="small">Follow @haxeflixel</a>

				<script>!function (d, s, id)
				{
					var js, fjs = d.getElementsByTagName (s)[0];
					if (!d.getElementById (id))
					{
						js = d.createElement (s);
						js.id = id;
						js.src = "//platform.twitter.com/widgets.js";
						fjs.parentNode.insertBefore (js, fjs);
					}
				} (document, "script", "twitter-wjs");</script>

			</div>

			<div class="footer-powered-by">
				<p>HaxeFlixel is powered by</p>
				<a href="http://haxe.org"><img src="/images/haxe.svg" alt="Haxe" title="Haxe"></a>
				+
				<a href="http://openfl.org"><img class="openfl-footer-logo" src="/images/openfl.svg" alt="OpenFL" title="OpenFL"></a>
				+
				<a href="http://flixel.org"><img class="flixel-footer-logo" src="/images/flixel.svg" alt="Flixel" title="Flixel"></a>
			</div>

		</div>
	</div>
</footer>

<script >(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-35511281-1');
ga('send', 'pageview');</script><script defer="defer"  src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script defer="defer"  src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script><script defer="defer"  src="/vendor/twitter-bootstrap-3/js/dropdown.js"></script><script defer="defer"  src="/vendor/twitter-bootstrap-3/js/transition.js"></script><script defer="defer"  src="/vendor/twitter-bootstrap-3/js/collapse.js"></script>

</body>

</html>

<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8"/>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

	<title>Part X:  Winning and Losing and Menus | HaxeFlixel 2D Game Framework</title>

	<meta name="description" content="HaxeFlixel is a 2D Game framework that lets you create cross-platform games easier with free, open source technology!"/>
	<meta name="keywords" content="gamedev, game development, cross-platform, haxe, flixel"/>
	<meta name="author" content=""/>
	<meta name="viewport" content="width=device-width"/>

	<link rel="shortcut icon" href="/images/favicon.ico">

	<!--[if lt IE 9]>
	<script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<link  rel="stylesheet" href="/styles/style.css" />

</head>


<body>

<header>
	<nav>

		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">

				<div class="navbar-header">
					<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="/" class="navbar-brand"><img src="/images/haxeflixel-header.png" alt="HaxeFlixel"></a>
				</div>

				<div class="navbar-collapse collapse">

					<ul class="nav navbar-nav">

						<li >
							<a href="/demos">Demos</a>
						</li>

                        <li class="dropdown" >

                            <a href="/showcase" class="dropdown-toggle" data-toggle="dropdown">Showcase <span class="caret"></span></a>

                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <a href="/showcase/games">Games</a>
                                </li>
                                <li>
                                    <a href="/showcase/jams">Jams</a>
                                </li>
                            </ul>

                        </li>

						<li >
							<a href="/blog">Blog</a>
						</li>

						<li class='active'>
							<a href="/documentation">Docs</a>
						</li>

						<li>
							<a href="http://api.haxeflixel.com" target="_blank">API</a>
						</li>

						<li >
							<a href="/forum">Forum</a>
						</li>

					</ul>
		
					<form class="navbar-form search-form" role="search" action="http://google.com/search" method="get">
    <div class="form-group">
        <input type="search" name="q" class="form-control" placeholder="Search">
        <input type="hidden" name="q" value="site:http://haxeflixel.com">
    </div>
</form>

				</div>

			</div>

		</div>

	</nav>
</header>

<div class="container container-main">
	<div class="row">

		<div class="col-md-3">
			<div class="doc-nav affix">
				<ul class="nav">



	<li>
		<h4><a href="/documentation/getting-started">Getting Started</a><h4>
	</li>

	



	<li>
		<h4><a href="/documentation/community">Community</a><h4>
	</li>

	



	<li>
		<h4><a href="/documentation/haxeflixel-handbook">HaxeFlixel Handbook</a><h4>
	</li>

	



	<li>
		<h4><a href="/documentation/resources">Resources</a><h4>
	</li>

	



	<li>
		<h4><a href="/documentation/tutorials">Tutorials</a><h4>
	</li>

	
		
			<li class= about="/documentation/tutorials">
				<a href="/documentation/tutorials"> Tutorials </a>
			</li>
		
			<li class= about="/documentation/the-power-of-haxeflixel">
				<a href="/documentation/the-power-of-haxeflixel"> The Power of HaxeFlixel </a>
			</li>
		
			<li class= about="/documentation/part-i-setup">
				<a href="/documentation/part-i-setup"> Part I: Setup </a>
			</li>
		
			<li class= about="/documentation/part-ii-testing">
				<a href="/documentation/part-ii-testing"> Part II: Testing wit ... </a>
			</li>
		
			<li class= about="/documentation/part-iii-groundwork">
				<a href="/documentation/part-iii-groundwork"> Part III: Groundwork </a>
			</li>
		
			<li class= about="/documentation/part-iv-sprites-and-animation">
				<a href="/documentation/part-iv-sprites-and-animation"> Part IV: Sprites and ... </a>
			</li>
		
			<li class= about="/documentation/part-v-tiles-maps-and-collisions">
				<a href="/documentation/part-v-tiles-maps-and-collisions"> Part V: Tiles, Maps, ... </a>
			</li>
		
			<li class= about="/documentation/part-vi-zoom-and-cameras">
				<a href="/documentation/part-vi-zoom-and-cameras"> Part VI: Zoom and Cameras </a>
			</li>
		
			<li class= about="/documentation/part-vii-pickups">
				<a href="/documentation/part-vii-pickups"> Part VII: Pickups </a>
			</li>
		
			<li class= about="/documentation/part-viii-enemies-and-basic-ai">
				<a href="/documentation/part-viii-enemies-and-basic-ai"> Part VIII: Enemies a ... </a>
			</li>
		
			<li class= about="/documentation/part-ix-ui-and-combat">
				<a href="/documentation/part-ix-ui-and-combat"> Part IX: UI and Combat </a>
			</li>
		
			<li class=active about="/documentation/part-x-winning-and-losing-and-menus">
				<a href="/documentation/part-x-winning-and-losing-and-menus"> Part X:  Winning and ... </a>
			</li>
		
			<li class= about="/documentation/part-xi-sound-and-music">
				<a href="/documentation/part-xi-sound-and-music"> Part XI: Sound and Music </a>
			</li>
		
			<li class= about="/documentation/part-xii-multiple-platforms">
				<a href="/documentation/part-xii-multiple-platforms"> Part XII: Multiple Platforms </a>
			</li>
		
			<li class= about="/documentation/part-xiii-polish-finishing-up-and-juice">
				<a href="/documentation/part-xiii-polish-finishing-up-and-juice"> Part XIII: Polish, f ... </a>
			</li>
		
			<li class= about="/documentation/conclusion">
				<a href="/documentation/conclusion"> Conclusion </a>
			</li>
		
	



</ul>
			</div>
		</div>

		<div class="col-md-9 doc-content" role="main">
			<h1 class="title">Part X:  Winning and Losing and Menus</h1>

			
			<a href="https://github.com/HaxeFlixel/flixel-docs/blob/master/documentation/04_tutorials/11-part-x-winning-and-losing-and-menus.html.md" class="btn btn-sm btn-edit" target="_blank"><span class="glyphicon glyphicon-pencil"></span> Edit </a>

			<p>Our game is really starting to come together! Now we need it to feel more like a &#39;game&#39; with a win and lose scenario. For our (very simple) game, we&#39;ll just make it so that if you ever die in combat, you get a Game Over, and when you beat the boss enemy, you Win. Both of these conditions will take you to the same FlxState to show you your score and allow you to play again if you want.</p>

<ol>
    <li>
        <p>The first thing we want to do is stop our CombatHUD from stopping once the player has been defeated. So in the doneResultsIn function, remove the <code>if (outcome != DEFEAT)</code> statement.</p>
    </li>
    <li>
        <p>We also need to make sure that when our CombatHUD gets destroyed it cleans up all the objects that it has properly. So add this function:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">override</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">()</span><span class="type">:Void</span>
{</span>
    super.destroy();
    e = FlxDestroyUtil.destroy(e);
    _sprBack = FlxDestroyUtil.destroy(_sprBack);
    _sprPlayer = FlxDestroyUtil.destroy(_sprPlayer);
    _sprEnemy = FlxDestroyUtil.destroy(_sprEnemy);
    _enemyHealthBar = FlxDestroyUtil.destroy(_enemyHealthBar);
    _txtPlayerHealth = FlxDestroyUtil.destroy(_txtPlayerHealth);
    _damages = FlxDestroyUtil.destroyArray(_damages);
    _pointer = FlxDestroyUtil.destroy(_pointer);
    _choices = FlxDestroyUtil.destroyArray(_choices);
    _results = FlxDestroyUtil.destroy(_results);
}</code></pre></p>
        <p>It&#39;s good practice to get into the habit of destroying all your objects in the destroy function of a class.</p>
    </li>
    <li>
        <p>Now, in PlayState, we need to add some flags to see if we&#39;re ending the game, and if the player has &#39;won&#39; or not. So, add:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">private</span> <span class="keyword">var</span> _ending:Bool;
<span class="keyword">private</span> <span class="keyword">var</span> _won:Bool;</code></pre></p>
        <p>To the top of the class.</p>
    </li>
    <li>
        <p>Next, in the update function, right under super.update() add:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">if</span> (_ending)
{
    <span class="keyword">return</span>;
}</code></pre></p>
        <p>We don&#39;t want to allow anything else to go on if we&#39;re ending the game and getting ready to switch states.</p>
    </li>
    <li>
        <p>Next, still in update, we&#39;re going to change our combatHud logic to this:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">if</span> (!_combatHud.visible)
{
    _health = _combatHud.playerHealth;
    _hud.updateHUD(_health, _money);
    <span class="keyword">if</span> (_combatHud.outcome == DEFEAT)
    {
        _ending = <span class="literal">true</span>;
        FlxG.camera.fade(FlxColor.BLACK, <span class="number">.33</span>, <span class="literal">false</span>, doneFadeOut);
    }
    <span class="keyword">else</span>
    {
        <span class="keyword">if</span> (_combatHud.outcome == VICTORY)
        {
            _combatHud.e.kill();
            <span class="keyword">if</span> (_combatHud.e.etype == <span class="number">1</span>)
            {
                _won = <span class="literal">true</span>;
                _ending = <span class="literal">true</span>;
                FlxG.camera.fade(FlxColor.BLACK, <span class="number">.33</span>, <span class="literal">false</span>, doneFadeOut);
            }
        }
        <span class="keyword">else</span> 
        {
            _combatHud.e.flicker();
        }
        _inCombat = <span class="literal">false</span>;
        _player.active = <span class="literal">true</span>;
        _grpEnemies.active = <span class="literal">true</span>;
    }
}</code></pre></p>
        <p>This will now check to see if the outcome was DEFEAT, and if it was, it will set our ending flag to true, and then tell the camera to start fading out - calling doneFadeOut when it&#39;s done.</p>
        <p>Similarly, if the outcome was VICTORY, and the enemy that was just defeated was type 1 (the boss), we set our won flag to true, and also start fading out.</p>
    </li>
    <li>
        <p>When the camera is done fading to black, we call this function, which will switch the state to our GameOverState (which you&#39;ll make in a second), passing it if the player won or not, and how much money they have.</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">doneFadeOut</span><span class="params">()</span><span class="type">:Void</span> 
{</span>
    FlxG.switchState(<span class="keyword">new</span> GameOverState(_won, _money));
}</code></pre></p>
    </li>
    <li>
        <p>Make sure we clean up our objects when this state is destroyed (in the destroy function):</p>
        <p><pre class="highlight"><code class="actionscript">_player = FlxDestroyUtil.destroy(_player);
_mWalls = FlxDestroyUtil.destroy(_mWalls);
_grpCoins = FlxDestroyUtil.destroy(_grpCoins);
_grpEnemies = FlxDestroyUtil.destroy(_grpEnemies);
_hud = FlxDestroyUtil.destroy(_hud);
_combatHud = FlxDestroyUtil.destroy(_combatHud);</code></pre></p>
    </li>
    <li>
        <p>We need to add the GameOverState. This is going to be a pretty simple FlxState where we show a message - either &quot;Game Over&quot; or &quot;You Win!&quot;, depending on our won flag, and the final score for this player. We will also use flixel&#39;s save/load functionality to compare the previous hi-scores, and, if the new score is higher, replace the saved hi-score, and show the hi-score on the screen.</p>
        <p>Finally, we have a button to take the player back to the main menu.</p>
        <p>Here is the code for that State:</p>
        <p><a href="https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-X/source/GameOverState.hx"><a href="https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-X/source/GameOverState.hx">https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-X/source/GameOverState.hx</a></a></p>
    </li>
</ol>

<p>If you test your game, you should be able to trigger the GameOverState by either dying in combat or defeating the boss, and then clicking on the button in the GameOverState will take you back to our MenuState so you can play again. If all of that works, you&#39;re on the right track! But… our MenuState is looking a little bland, now… let&#39;s fix that up!</p>

<p><img src="/images/tutorial/0021.png" /></p>

<ol>
    <li>
        <p>Let&#39;s add a title and an options button to the MenuState:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">private</span> <span class="keyword">var</span> _txtTitle:FlxText;
<span class="keyword">private</span> <span class="keyword">var</span> _btnOptions:FlxButton;</code></pre></p>
    </li>
    <li>
        <p>Then, in create, we&#39;ll add them to the state (and move the Play button, as well):</p>
        <p><pre class="highlight"><code class="actionscript">_txtTitle = <span class="keyword">new</span> FlxText(<span class="number">20</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">"HaxeFlixel\nTutorial\nGame"</span>, <span class="number">22</span>);
_txtTitle.alignment = <span class="string">"center"</span>;
_txtTitle.screenCenter(<span class="literal">true</span>, <span class="literal">false</span>);
add(_txtTitle);

_btnPlay = <span class="keyword">new</span> FlxButton(<span class="number">0</span>, <span class="number">0</span>, <span class="string">"Play"</span>, clickPlay);
_btnPlay.x = (FlxG.width / <span class="number">2</span>) - _btnPlay.width - <span class="number">10</span>;
_btnPlay.y = FlxG.height - _btnPlay.height - <span class="number">10</span>;
add(_btnPlay);

_btnOptions = <span class="keyword">new</span> FlxButton(<span class="number">0</span>, <span class="number">0</span>, <span class="string">"Options"</span>, clickOptions);
_btnOptions.x = (FlxG.width / <span class="number">2</span>) + <span class="number">10</span>;
_btnOptions.y = FlxG.height - _btnOptions.height - <span class="number">10</span>;
add(_btnOptions);</code></pre></p>
    </li>
    <li>
        <p>Add the function that gets called when the options button is clicked:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">clickOptions</span><span class="params">()</span><span class="type">:Void</span>
{</span>
    FlxG.switchState(<span class="keyword">new</span> OptionsState());
}</code></pre></p>
    </li>
    <li>
        <p>Then, finally, add some clean-up logic to our destroy function:</p>
        <p><pre class="highlight"><code class="actionscript">_txtTitle = FlxDestroyUtil.destroy(_txtTitle);
_btnPlay = FlxDestroyUtil.destroy(_btnPlay);
_btnOptions = FlxDestroyUtil.destroy(_btnOptions);</code></pre></p>
    </li>
    <li>
        <p>The OptionsState that is called from the options button is fairly simple. It will contain a button to allow the user to clear the saved data (hi-scores, etc), as well as a simple FlxBar to show the user the current volume level of the game with buttons to adjust it up or down. It will save the volume values so that each time the game starts, it will &#39;remember&#39; what volume it was last set to (I know there&#39;s no sound…. yet ;) )</p>
        <p>The code for this State looks like this:</p>
        <p><a href="https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-X/source/OptionsState.hx"><a href="https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-X/source/OptionsState.hx">https://github.com/SeiferTim/HaxeFlixel-Tutorial/blob/Part-X/source/OptionsState.hx</a></a></p>
    </li>
    <li>
        <p>Finally, we want our game to load the stored volume (if there is any) each time the game starts, so, goto our Main.hx file, and, in setupGame, after addChild, add:</p>
        <p><pre class="highlight"><code class="actionscript"><span class="keyword">var</span> _save:FlxSave = <span class="keyword">new</span> FlxSave();
_save.bind(<span class="string">"flixel-tutorial"</span>);
<span class="keyword">if</span> (_save.data.volume != <span class="literal">null</span>)
{
    FlxG.sound.volume = _save.data.volume;
}
_save.close();</code></pre></p>
        <p>Pretty simple: it makes a new FlxSave object, binds it to our &quot;flixel-tutorial&quot; and then checks if there is a volume value stored in it, and if there is, sets our game&#39;s volume to match, and then closes the save.</p>
    </li>
</ol>

<p>Test everything out, make sure it&#39;s working, and that if you change your volume under options and then exit the game, it retains the value the next time to get into the options screen.</p>

<p><img src="/images/tutorial/0022.png" /></p>

<p>Looking good! Next time we&#39;ll give our volume something to do by adding sound and music!</p>
<p>You can check out the current source for everything so far, <a href="https://github.com/SeiferTim/HaxeFlixel-Tutorial/tree/Part-X">here</a>!</p>

			<br>
			<hr>

			<ul class="pager">
				

				<li class="previous">
					<a href="/documentation/part-ix-ui-and-combat">< Part IX: UI and Combat</a>
				</li>
				


				
				<li class="next">
					<a href="/documentation/part-xi-sound-and-music">Part XI: Sound and Music ></a>
				</li>
				
			</ul>


		</div>
	</div>
</div>

<footer>
	<div class="footer-main">
		<div class=" container">

			<div class="footer-social">

				<iframe width="120px" scrolling="0" height="20px" frameborder="0"
						allowtransparency="true"
						src="http://ghbtns.com/github-btn.html?user=HaxeFlixel&amp;repo=flixel&amp;type=watch&amp;count=true&amp;size=small"></iframe>

				<a href="https://twitter.com/haxeflixel" class="twitter-follow-button" data-show-count="true"
				   data-lang="en" data-size="small">Follow @haxeflixel</a>

				<script>!function (d, s, id)
				{
					var js, fjs = d.getElementsByTagName (s)[0];
					if (!d.getElementById (id))
					{
						js = d.createElement (s);
						js.id = id;
						js.src = "//platform.twitter.com/widgets.js";
						fjs.parentNode.insertBefore (js, fjs);
					}
				} (document, "script", "twitter-wjs");</script>

			</div>

			<div class="footer-powered-by">
				<p>HaxeFlixel is powered by</p>
				<a href="http://haxe.org"><img src="/images/haxe.svg" alt="Haxe" title="Haxe"></a>
				+
				<a href="http://openfl.org"><img class="openfl-footer-logo" src="/images/openfl.svg" alt="OpenFL" title="OpenFL"></a>
				+
				<a href="http://flixel.org"><img class="flixel-footer-logo" src="/images/flixel.svg" alt="Flixel" title="Flixel"></a>
			</div>

		</div>
	</div>
</footer>

<script >(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-35511281-1');
ga('send', 'pageview');</script><script defer="defer"  src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script defer="defer"  src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script><script defer="defer"  src="/vendor/twitter-bootstrap-3/js/dropdown.js"></script><script defer="defer"  src="/vendor/twitter-bootstrap-3/js/transition.js"></script><script defer="defer"  src="/vendor/twitter-bootstrap-3/js/collapse.js"></script>

</body>

</html>
